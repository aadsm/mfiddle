montageDefine("bf08a23","listen/property-changes",{dependencies:["../shim","weak-map"],factory:function(t,e,n){function i(){throw Error("This is an abstract interface. Mix it. Don't construct it")}t("../shim");var a=t("weak-map"),r=Object.prototype.hasOwnProperty,s=new a,o=new a;n.exports=i,i.debug=!0,i.prototype.getOwnPropertyChangeDescriptor=function(t){s.has(this)||s.set(this,{});var e=s.get(this);return r.call(e,t)||(e[t]={willChangeListeners:[],changeListeners:[]}),e[t]},i.prototype.hasOwnPropertyChangeDescriptor=function(t){if(!s.has(this))return!1;if(!t)return!0;var e=s.get(this);return r.call(e,t)?!0:!1},i.prototype.addOwnPropertyChangeListener=function(t,e,n){this.makeObservable&&!this.isObservable&&this.makeObservable();var a,r=i.getOwnPropertyChangeDescriptor(this,t);a=n?r.willChangeListeners:r.changeListeners,i.makePropertyObservable(this,t),a.push(e);var s=this;return function(){i.removeOwnPropertyChangeListener(s,t,a,n),s=null}},i.prototype.addBeforeOwnPropertyChangeListener=function(t,e){return i.addOwnPropertyChangeListener(this,t,e,!0)},i.prototype.removeOwnPropertyChangeListener=function(t,e,n){var a,r=i.getOwnPropertyChangeDescriptor(this,t);a=n?r.willChangeListeners:r.changeListeners;var s=a.lastIndexOf(e);if(-1===s)throw Error("Can't remove listener: does not exist.");a.splice(s,1),0===r.changeListeners.length+r.willChangeListeners.length&&i.makePropertyUnobservable(this,t)},i.prototype.removeBeforeOwnPropertyChangeListener=function(t,e){return i.removeOwnPropertyChangeListener(this,t,e,!0)},i.prototype.dispatchOwnPropertyChange=function(t,e,n){var a=i.getOwnPropertyChangeDescriptor(this,t);if(!a.isActive){a.isActive=!0;var r;r=n?a.willChangeListeners:a.changeListeners;var s=(n?"Will":"")+"Change",o="handleProperty"+s,l=t+"";l=l&&l[0].toUpperCase()+l.slice(1);var c="handle"+l+s;try{r.forEach(function(n){var i=n;n=n[c]||n[o]||n,n.call(i,e,t,this)},this)}finally{a.isActive=!1}}},i.prototype.dispatchBeforeOwnPropertyChange=function(t,e){return i.dispatchOwnPropertyChange(this,t,e,!0)},i.prototype.makePropertyObservable=function(t){if(!Array.isArray(this)){if(!Object.isExtensible(this,t))throw Error("Can't make property "+JSON.stringify(t)+" observable on "+this+" because object is not extensible");var e;"object"==typeof this.__state__?e=this.__state__:(e={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:e,writable:!0,enumerable:!1})),e[t]=this[t],o.has(this)||(n={},o.set(this,n));var n=o.get(this);if(!r.call(n,t)){var a,s=this;Object.getOwnPropertyDescriptor(s,t);do{if(a=Object.getOwnPropertyDescriptor(s,t))break;s=Object.getPrototypeOf(s)}while(s);if(a=a||{value:void 0,enumerable:!0,writable:!0,configurable:!0},!a.configurable)throw Error("Can't observe non-configurable properties");if(n[t]=a,a.writable||a.set){var l;l="value"in a?{get:function(){return a.value},set:function(n){return n===a.value?n:(i.dispatchBeforeOwnPropertyChange(this,t,a.value),a.value=n,e[t]=n,i.dispatchOwnPropertyChange(this,t,n),n)},enumerable:a.enumerable,configurable:!0}:{get:function(){return a.get?a.get.apply(this,arguments):void 0},set:function(n){var r;return a.get&&(r=a.get.apply(this,arguments)),a.set&&a.set.apply(this,arguments),a.get&&(n=a.get.apply(this,arguments),e[t]=n),n===r?n:(i.dispatchBeforeOwnPropertyChange(this,t,r),i.dispatchOwnPropertyChange(this,t,n),n)},enumerable:a.enumerable,configurable:!0},Object.defineProperty(this,t,l)}}}},i.prototype.makePropertyUnobservable=function(t){if(!Array.isArray(this)){if(!o.has(this))throw Error("Can't uninstall observer on property");var e=o.get(this);if(!e[t])throw Error("Can't uninstall observer on property");var n=e[t];delete e[t];var i;"object"==typeof this.__state__?i=this.__state__:(i={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:i,writable:!0,enumerable:!1})),delete i[t],Object.defineProperty(this,t,n)}},i.getOwnPropertyChangeDescriptor=function(t,e){return t.getOwnPropertyChangeDescriptor?t.getOwnPropertyChangeDescriptor(e):i.prototype.getOwnPropertyChangeDescriptor.call(t,e)},i.hasOwnPropertyChangeDescriptor=function(t,e){return t.hasOwnPropertyChangeDescriptor?t.hasOwnPropertyChangeDescriptor(e):i.prototype.hasOwnPropertyChangeDescriptor.call(t,e)},i.addOwnPropertyChangeListener=function(t,e,n,a){return Object.isObject(t)?t.addOwnPropertyChangeListener?t.addOwnPropertyChangeListener(e,n,a):i.prototype.addOwnPropertyChangeListener.call(t,e,n,a):void 0},i.removeOwnPropertyChangeListener=function(t,e,n,a){return Object.isObject(t)?t.removeOwnPropertyChangeListener?t.removeOwnPropertyChangeListener(e,n,a):i.prototype.removeOwnPropertyChangeListener.call(t,e,n,a):void 0},i.dispatchOwnPropertyChange=function(t,e,n,a){return Object.isObject(t)?t.dispatchOwnPropertyChange?t.dispatchOwnPropertyChange(e,n,a):i.prototype.dispatchOwnPropertyChange.call(t,e,n,a):void 0},i.addBeforeOwnPropertyChangeListener=function(t,e,n){return i.addOwnPropertyChangeListener(t,e,n,!0)},i.removeBeforeOwnPropertyChangeListener=function(t,e,n){return i.removeOwnPropertyChangeListener(t,e,n,!0)},i.dispatchBeforeOwnPropertyChange=function(t,e,n){return i.dispatchOwnPropertyChange(t,e,n,!0)},i.makePropertyObservable=function(t,e){return t.makePropertyObservable?t.makePropertyObservable(e):i.prototype.makePropertyObservable.call(t,e)},i.makePropertyUnobservable=function(t,e){return t.makePropertyUnobservable?t.makePropertyUnobservable(e):i.prototype.makePropertyUnobservable.call(t,e)}}});