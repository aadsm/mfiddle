"use strict";function RangeChanges(){throw Error("Can't construct. RangeChanges is a mixin.")}var WeakMap=require("weak-map"),Dict=require("../dict"),rangeChangeDescriptors=new WeakMap;module.exports=RangeChanges,RangeChanges.prototype.getAllRangeChangeDescriptors=function(){return rangeChangeDescriptors.has(this)||rangeChangeDescriptors.set(this,Dict()),rangeChangeDescriptors.get(this)},RangeChanges.prototype.getRangeChangeDescriptor=function(t){var e=this.getAllRangeChangeDescriptors();return t=t||"",e.has(t)||e.set(t,{isActive:!1,changeListeners:[],willChangeListeners:[]}),e.get(t)},RangeChanges.prototype.addRangeChangeListener=function(t,e,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var i,a=this.getRangeChangeDescriptor(e);i=n?a.willChangeListeners:a.changeListeners,i.push(t),this.dispatchesRangeChanges=!0;var r=this;return function(){r&&(r.removeRangeChangeListener(t,e,n),r=null)}},RangeChanges.prototype.removeRangeChangeListener=function(t,e,n){var i,a=this.getRangeChangeDescriptor(e);i=n?a.willChangeListeners:a.changeListeners;var r=i.lastIndexOf(t);if(-1===r)throw Error("Can't remove listener: does not exist.");i.splice(r,1)},RangeChanges.prototype.dispatchRangeChange=function(t,e,n,i){var a=this.getAllRangeChangeDescriptors(),r="Range"+(i?"WillChange":"Change");a.forEach(function(a,s){if(!a.isActive){a.isActive=!0;var o;o=i?a.willChangeListeners:a.changeListeners;var l="handle"+(s.slice(0,1).toUpperCase()+s.slice(1))+r;try{o.forEach(function(a){if(a[l])a[l](t,e,n,this,i);else{if(!a.call)throw Error("Handler "+a+" has no method "+l+" and is not callable");a.call(this,t,e,n,this,i)}},this)}finally{a.isActive=!1}}},this)},RangeChanges.prototype.addBeforeRangeChangeListener=function(t,e){return this.addRangeChangeListener(t,e,!0)},RangeChanges.prototype.removeBeforeRangeChangeListener=function(t,e){return this.removeRangeChangeListener(t,e,!0)},RangeChanges.prototype.dispatchBeforeRangeChange=function(t,e,n){return this.dispatchRangeChange(t,e,n,!0)};