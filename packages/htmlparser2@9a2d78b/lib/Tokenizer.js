function whitespace(t){return" "===t||"	"===t||"\r"===t||"\n"===t}function Tokenizer(t,e){this._state=TEXT,this._buffer="",this._sectionStart=0,this._index=0,this._options=t,this._special=0,this._cbs=e,this._running=!0}module.exports=Tokenizer;var i=0,TEXT=i++,BEFORE_TAG_NAME=i++,IN_TAG_NAME=i++,BEFORE_CLOSING_TAG_NAME=i++,IN_CLOSING_TAG_NAME=i++,AFTER_CLOSING_TAG_NAME=i++,BEFORE_ATTRIBUTE_NAME=i++,IN_ATTRIBUTE_NAME=i++,AFTER_ATTRIBUTE_NAME=i++,BEFORE_ATTRIBUTE_VALUE=i++,IN_ATTRIBUTE_VALUE_DOUBLE_QUOTES=i++,IN_ATTRIBUTE_VALUE_SINGLE_QUOTES=i++,IN_ATTRIBUTE_VALUE_NO_QUOTES=i++,BEFORE_DECLARATION=i++,IN_DECLARATION=i++,IN_PROCESSING_INSTRUCTION=i++,BEFORE_COMMENT=i++,IN_COMMENT=i++,AFTER_COMMENT_1=i++,AFTER_COMMENT_2=i++,BEFORE_CDATA_1=i++,BEFORE_CDATA_2=i++,BEFORE_CDATA_3=i++,BEFORE_CDATA_4=i++,BEFORE_CDATA_5=i++,BEFORE_CDATA_6=i++,IN_CDATA=i++,AFTER_CDATA_1=i++,AFTER_CDATA_2=i++,BEFORE_SPECIAL=i++,BEFORE_SPECIAL_END=i++,BEFORE_SCRIPT_1=i++,BEFORE_SCRIPT_2=i++,BEFORE_SCRIPT_3=i++,BEFORE_SCRIPT_4=i++,BEFORE_SCRIPT_5=i++,AFTER_SCRIPT_1=i++,AFTER_SCRIPT_2=i++,AFTER_SCRIPT_3=i++,AFTER_SCRIPT_4=i++,AFTER_SCRIPT_5=i++,BEFORE_STYLE_1=i++,BEFORE_STYLE_2=i++,BEFORE_STYLE_3=i++,BEFORE_STYLE_4=i++,AFTER_STYLE_1=i++,AFTER_STYLE_2=i++,AFTER_STYLE_3=i++,AFTER_STYLE_4=i++;Tokenizer.prototype.write=function(t){for(this._buffer+=t;this._index<this._buffer.length&&this._running;){var e=this._buffer.charAt(this._index);this._state===TEXT?"<"===e&&(this._emitIfToken("text"),this._state=BEFORE_TAG_NAME,this._sectionStart=this._index):this._state===BEFORE_TAG_NAME?"/"===e?this._state=BEFORE_CLOSING_TAG_NAME:">"===e||this._special>0?this._state=TEXT:whitespace(e)||("!"===e?(this._state=BEFORE_DECLARATION,this._sectionStart=this._index+1):"?"===e?(this._state=IN_PROCESSING_INSTRUCTION,this._sectionStart=this._index+1):this._options&&this._options.xmlMode||"s"!==e&&"S"!==e?(this._state=IN_TAG_NAME,this._sectionStart=this._index):(this._state=BEFORE_SPECIAL,this._sectionStart=this._index)):this._state===IN_TAG_NAME?"/"===e?(this._emitToken("opentagname"),this._cbs.onselfclosingtag(),this._state=AFTER_CLOSING_TAG_NAME):">"===e?(this._emitToken("opentagname"),this._cbs.onopentagend(),this._state=TEXT,this._sectionStart=this._index+1):whitespace(e)&&(this._emitToken("opentagname"),this._state=BEFORE_ATTRIBUTE_NAME):this._state===BEFORE_CLOSING_TAG_NAME?whitespace(e)||(">"===e?this._state=TEXT:this._special>0?("s"===e||"S"===e)&&(this._state=BEFORE_SPECIAL_END):(this._state=IN_CLOSING_TAG_NAME,this._sectionStart=this._index)):this._state===IN_CLOSING_TAG_NAME?">"===e?(this._emitToken("closetag"),this._state=TEXT,this._sectionStart=this._index+1,this._special=0):whitespace(e)&&(this._emitToken("closetag"),this._state=AFTER_CLOSING_TAG_NAME,this._special=0):this._state===AFTER_CLOSING_TAG_NAME?">"===e&&(this._state=TEXT,this._sectionStart=this._index+1):this._state===BEFORE_ATTRIBUTE_NAME?">"===e?(this._state=TEXT,this._cbs.onopentagend(),this._sectionStart=this._index+1):"/"===e?(this._cbs.onselfclosingtag(),this._state=AFTER_CLOSING_TAG_NAME):whitespace(e)||(this._state=IN_ATTRIBUTE_NAME,this._sectionStart=this._index):this._state===IN_ATTRIBUTE_NAME?"="===e?(this._emitIfToken("attribname"),this._state=BEFORE_ATTRIBUTE_VALUE):whitespace(e)?(this._emitIfToken("attribname"),this._state=AFTER_ATTRIBUTE_NAME):("/"===e||">"===e)&&(this._emitIfToken("attribname"),this._state=BEFORE_ATTRIBUTE_NAME,this._index--):this._state===AFTER_ATTRIBUTE_NAME?"="===e?this._state=BEFORE_ATTRIBUTE_VALUE:"/"===e||">"===e?(this._state=BEFORE_ATTRIBUTE_NAME,this._index--):whitespace(e)||(this._state=IN_ATTRIBUTE_NAME,this._sectionStart=this._index):this._state===BEFORE_ATTRIBUTE_VALUE?'"'===e?(this._state=IN_ATTRIBUTE_VALUE_DOUBLE_QUOTES,this._sectionStart=this._index+1):"'"===e?(this._state=IN_ATTRIBUTE_VALUE_SINGLE_QUOTES,this._sectionStart=this._index+1):whitespace(e)||(this._state=IN_ATTRIBUTE_VALUE_NO_QUOTES,this._sectionStart=this._index):this._state===IN_ATTRIBUTE_VALUE_DOUBLE_QUOTES?'"'===e&&(this._emitToken("attribvalue"),this._state=BEFORE_ATTRIBUTE_NAME):this._state===IN_ATTRIBUTE_VALUE_SINGLE_QUOTES?"'"===e&&(this._emitToken("attribvalue"),this._state=BEFORE_ATTRIBUTE_NAME):this._state===IN_ATTRIBUTE_VALUE_NO_QUOTES?">"===e?(this._emitToken("attribvalue"),this._state=TEXT,this._cbs.onopentagend(),this._sectionStart=this._index+1):whitespace(e)&&(this._emitToken("attribvalue"),this._state=BEFORE_ATTRIBUTE_NAME):this._state===BEFORE_DECLARATION?this._state="["===e?BEFORE_CDATA_1:"-"===e?BEFORE_COMMENT:IN_DECLARATION:this._state===IN_DECLARATION?">"===e&&(this._emitToken("declaration"),this._state=TEXT,this._sectionStart=this._index+1):this._state===IN_PROCESSING_INSTRUCTION?">"===e&&(this._emitToken("processinginstruction"),this._state=TEXT,this._sectionStart=this._index+1):this._state===BEFORE_COMMENT?"-"===e?(this._state=IN_COMMENT,this._sectionStart=this._index+1):this._state=IN_DECLARATION:this._state===IN_COMMENT?"-"===e&&(this._state=AFTER_COMMENT_1):this._state===AFTER_COMMENT_1?this._state="-"===e?AFTER_COMMENT_2:IN_COMMENT:this._state===AFTER_COMMENT_2?">"===e?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=TEXT,this._sectionStart=this._index+1):this._state=IN_COMMENT:this._state===BEFORE_CDATA_1?this._state="C"===e?BEFORE_CDATA_2:IN_DECLARATION:this._state===BEFORE_CDATA_2?this._state="D"===e?BEFORE_CDATA_3:IN_DECLARATION:this._state===BEFORE_CDATA_3?this._state="A"===e?BEFORE_CDATA_4:IN_DECLARATION:this._state===BEFORE_CDATA_4?this._state="T"===e?BEFORE_CDATA_5:IN_DECLARATION:this._state===BEFORE_CDATA_5?this._state="A"===e?BEFORE_CDATA_6:IN_DECLARATION:this._state===BEFORE_CDATA_6?"["===e?(this._state=IN_CDATA,this._sectionStart=this._index+1):this._state=IN_DECLARATION:this._state===IN_CDATA?"]"===e&&(this._state=AFTER_CDATA_1):this._state===AFTER_CDATA_1?this._state="]"===e?AFTER_CDATA_2:IN_CDATA:this._state===AFTER_CDATA_2?">"===e?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=TEXT,this._sectionStart=this._index+1):this._state=IN_CDATA:this._state===BEFORE_SPECIAL?"c"===e||"C"===e?this._state=BEFORE_SCRIPT_1:"t"===e||"T"===e?this._state=BEFORE_STYLE_1:(this._state=IN_TAG_NAME,this._index--):this._state===BEFORE_SPECIAL_END?this._state=1!==this._special||"c"!==e&&"C"!==e?2!==this._special||"t"!==e&&"T"!==e?TEXT:AFTER_STYLE_1:AFTER_SCRIPT_1:this._state===BEFORE_SCRIPT_1?"r"===e||"R"===e?this._state=BEFORE_SCRIPT_2:(this._state=IN_TAG_NAME,this._index--):this._state===BEFORE_SCRIPT_2?"i"===e||"I"===e?this._state=BEFORE_SCRIPT_3:(this._state=IN_TAG_NAME,this._index--):this._state===BEFORE_SCRIPT_3?"p"===e||"P"===e?this._state=BEFORE_SCRIPT_4:(this._state=IN_TAG_NAME,this._index--):this._state===BEFORE_SCRIPT_4?"t"===e||"T"===e?this._state=BEFORE_SCRIPT_5:(this._state=IN_TAG_NAME,this._index--):this._state===BEFORE_SCRIPT_5?(("/"===e||">"===e||whitespace(e))&&(this._special=1),this._state=IN_TAG_NAME,this._index--):this._state===AFTER_SCRIPT_1?this._state="r"===e||"R"===e?AFTER_SCRIPT_2:TEXT:this._state===AFTER_SCRIPT_2?this._state="i"===e||"I"===e?AFTER_SCRIPT_3:TEXT:this._state===AFTER_SCRIPT_3?this._state="p"===e||"P"===e?AFTER_SCRIPT_4:TEXT:this._state===AFTER_SCRIPT_4?this._state="t"===e||"T"===e?AFTER_SCRIPT_5:TEXT:this._state===AFTER_SCRIPT_5?">"===e||whitespace(e)?(this._state=IN_CLOSING_TAG_NAME,this._sectionStart=this._index-6,this._index--):this._state=TEXT:this._state===BEFORE_STYLE_1?"y"===e||"Y"===e?this._state=BEFORE_STYLE_2:(this._state=IN_TAG_NAME,this._index--):this._state===BEFORE_STYLE_2?"l"===e||"L"===e?this._state=BEFORE_STYLE_3:(this._state=IN_TAG_NAME,this._index--):this._state===BEFORE_STYLE_3?"e"===e||"E"===e?this._state=BEFORE_STYLE_4:(this._state=IN_TAG_NAME,this._index--):this._state===BEFORE_STYLE_4?(("/"===e||">"===e||whitespace(e))&&(this._special=2),this._state=IN_TAG_NAME,this._index--):this._state===AFTER_STYLE_1?this._state="y"===e||"Y"===e?AFTER_STYLE_2:TEXT:this._state===AFTER_STYLE_2?this._state="l"===e||"L"===e?AFTER_STYLE_3:TEXT:this._state===AFTER_STYLE_3?this._state="e"===e||"E"===e?AFTER_STYLE_4:TEXT:this._state===AFTER_STYLE_4?">"===e||whitespace(e)?(this._state=IN_CLOSING_TAG_NAME,this._sectionStart=this._index-5,this._index--):this._state=TEXT:this._cbs.onerror(Error("unknown state"),this._state),this._index++}-1===this._sectionStart?(this._buffer="",this._index=0):(this._state===TEXT?(this._emitIfToken("text"),this._buffer="",this._index=0):this._sectionStart===this._index?(this._buffer="",this._index=0):this._sectionStart>0&&(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart),this._sectionStart=0)},Tokenizer.prototype.pause=function(){this._running=!1},Tokenizer.prototype.resume=function(){this._running=!0},Tokenizer.prototype.end=function(t){t&&this.write(t),""===this._buffer||-1===this._sectionStart||this._sectionStart===this._index||(this._state===IN_CDATA||this._state===AFTER_CDATA_1||this._state===AFTER_CDATA_2?this._emitIfToken("cdata"):this._state===IN_COMMENT||this._state===AFTER_COMMENT_1||this._state===AFTER_COMMENT_2?this._emitIfToken("comment"):this._state===IN_TAG_NAME?this._emitIfToken("opentagname"):this._state===IN_CLOSING_TAG_NAME?this._emitIfToken("closetag"):this._emitIfToken("text")),this._cbs.onend()},Tokenizer.prototype.reset=function(){Tokenizer.call(this,this._options,this._cbs)},Tokenizer.prototype._emitToken=function(t){this._cbs["on"+t](this._buffer.substring(this._sectionStart,this._index)),this._sectionStart=-1},Tokenizer.prototype._emitIfToken=function(t){this._index>this._sectionStart&&this._cbs["on"+t](this._buffer.substring(this._sectionStart,this._index)),this._sectionStart=-1};