"use strict";function Iterator(t){if(!(this instanceof Iterator))return new Iterator(t);if(Array.isArray(t)||"string"==typeof t)return Iterator.iterate(t);if(t=Object(t),t instanceof Iterator)return t;if(t.next)this.next=function(){return t.next()};else if(t.iterate){var e=t.iterate();this.next=function(){return e.next()}}else{if("[object Function]"!==Object.prototype.toString.call(t))throw new TypeError("Can't iterate "+t);this.next=t}}module.exports=Iterator;var Object=require("./shim-object"),GenericCollection=require("./generic-collection");Iterator.prototype.forEach=GenericCollection.prototype.forEach,Iterator.prototype.map=GenericCollection.prototype.map,Iterator.prototype.filter=GenericCollection.prototype.filter,Iterator.prototype.every=GenericCollection.prototype.every,Iterator.prototype.some=GenericCollection.prototype.some,Iterator.prototype.any=GenericCollection.prototype.any,Iterator.prototype.all=GenericCollection.prototype.all,Iterator.prototype.min=GenericCollection.prototype.min,Iterator.prototype.max=GenericCollection.prototype.max,Iterator.prototype.sum=GenericCollection.prototype.sum,Iterator.prototype.average=GenericCollection.prototype.average,Iterator.prototype.flatten=GenericCollection.prototype.flatten,Iterator.prototype.zip=GenericCollection.prototype.zip,Iterator.prototype.enumerate=GenericCollection.prototype.enumerate,Iterator.prototype.sorted=GenericCollection.prototype.sorted,Iterator.prototype.group=GenericCollection.prototype.group,Iterator.prototype.reversed=GenericCollection.prototype.reversed,Iterator.prototype.toArray=GenericCollection.prototype.toArray,Iterator.prototype.toObject=GenericCollection.prototype.toObject,Iterator.prototype.iterator=GenericCollection.prototype.iterator,Iterator.prototype.constructClone=function(t){var e=[];return e.addEach(t),e},Iterator.prototype.mapIterator=function(t){var e=Iterator(this),n=arguments[1],i=0;if("[object Function]"!=Object.prototype.toString.call(t))throw new TypeError;return new e.constructor(function(){return t.call(n,e.next(),i++,e)})},Iterator.prototype.filterIterator=function(t){var e=Iterator(this),n=arguments[1],i=0;if("[object Function]"!=Object.prototype.toString.call(t))throw new TypeError;return new e.constructor(function(){for(var a;;)if(a=e.next(),t.call(n,a,i++,e))return a})},Iterator.prototype.reduce=function(t){var e,n=Iterator(this),i=arguments[1],a=arguments[2],r=0;if("[object Function]"!=Object.prototype.toString.call(t))throw new TypeError;try{e=n.next(),i=arguments.length>1?t.call(a,i,e,r,n):e,r++}catch(s){if(isStopIteration(s)){if(arguments.length>1)return arguments[1];throw TypeError("cannot reduce a value from an empty iterator with no initial value")}throw s}try{for(;;)e=n.next(),i=t.call(a,i,e,r,n),r++}catch(s){if(isStopIteration(s))return i;throw s}},Iterator.prototype.concat=function(){return Iterator.concat(Array.prototype.concat.apply(this,arguments))},Iterator.prototype.dropWhile=function(t){var e,n=Iterator(this),i=arguments[1],a=!1;if("[object Function]"!=Object.prototype.toString.call(t))throw new TypeError;return n.forEach(function(r,s){if(!t.call(i,r,s,n))throw a=!0,e=r,StopIteration}),a?n.constructor([e]).concat(n):n.constructor([])},Iterator.prototype.takeWhile=function(t){var e=Iterator(this),n=arguments[1];if("[object Function]"!=Object.prototype.toString.call(t))throw new TypeError;return e.mapIterator(function(i,a){if(!t.call(n,i,a,e))throw StopIteration;return i})},Iterator.prototype.zipIterator=function(){return Iterator.unzip(Array.prototype.concat.apply(this,arguments))},Iterator.prototype.enumerateIterator=function(t){return Iterator.count(t).zipIterator(this)},Iterator.iterate=function(t){var e;return e=0,new Iterator(function(){if("object"==typeof t)for(;!(e in t);){if(e>=t.length)throw StopIteration;e+=1}else if(e>=t.length)throw StopIteration;var n=t[e];return e+=1,n})},Iterator.cycle=function(t,e){2>arguments.length&&(e=1/0);var n=function(){throw StopIteration};return new Iterator(function(){var i;try{return n()}catch(a){if(isStopIteration(a)){if(0>=e)throw a;return e--,i=Iterator.iterate(t),n=i.next.bind(i),n()}throw a}})},Iterator.concat=function(t){t=Iterator(t);var e=function(){throw StopIteration};return new Iterator(function(){var n;try{return e()}catch(i){if(isStopIteration(i))return n=Iterator(t.next()),e=n.next.bind(n),e();throw i}})},Iterator.unzip=function(t){return t=Iterator(t).map(Iterator),0===t.length?new Iterator([]):new Iterator(function(){var e,n=t.map(function(t){try{return t.next()}catch(n){if(!isStopIteration(n))throw n;e=!0}});if(e)throw StopIteration;return n})},Iterator.zip=function(){return Iterator.unzip(Array.prototype.slice.call(arguments))},Iterator.chain=function(){return Iterator.concat(Array.prototype.slice.call(arguments))},Iterator.range=function(t,e,n){return 3>arguments.length&&(n=1),2>arguments.length&&(e=t,t=0),t=t||0,n=n||1,new Iterator(function(){if(t>=e)throw StopIteration;var i=t;return t+=n,i})},Iterator.count=function(t,e){return Iterator.range(t,1/0,e)},Iterator.repeat=function(t,e){return new Iterator.range(e).mapIterator(function(){return t})},"undefined"==typeof isStopIteration&&(global.isStopIteration=function(t){return"[object StopIteration]"===Object.prototype.toString.call(t)}),"undefined"==typeof StopIteration&&(global.StopIteration={},Object.prototype.toString=function(t){return function(){return this===global.StopIteration||this instanceof global.ReturnValue?"[object StopIteration]":t.call(this,arguments)}}(Object.prototype.toString)),ReturnValue===void 0&&(global.ReturnValue=function ReturnValue(t){return this.message="Iteration stopped with "+t,Error.captureStackTrace&&Error.captureStackTrace(this,ReturnValue),this instanceof global.ReturnValue?(this.value=t,void 0):new global.ReturnValue(t)},ReturnValue.prototype=Error.prototype);