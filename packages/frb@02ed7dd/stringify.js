"use strict";function stringify(t,e){return stringify.semantics.stringify(t,e)}function makeBlockStringifier(t){return function(e,n,i){var r=t+"{"+i(e.args[1],n)+"}";return"value"===e.args[0].type?r:i(e.args[0],n)+"."+r}}var parse=require("./parse"),precedence=require("./language").precedence,typeToToken=require("./language").operatorTypes,tokenToType=require("./language").operatorTokens;module.exports=stringify,stringify.semantics={makeBlockStringifier:makeBlockStringifier,stringify:function(t,e,n){function i(t){var n=a(t,e);return n?n:"()"}var r,a=this.stringify.bind(this),s=this.stringifiers;if(s[t.type])r=s[t.type](t,e,a);else if(t.inline)r="&"+t.type+"("+t.args.map(i).join(", ")+")";else{var o;1===t.args.length&&"mapBlock"===t.args[0].type?(o=t.type+"{"+a(t.args[0].args[1],e)+"}",t=t.args[0]):o=t.type+"("+t.args.slice(1).map(i).join(", ")+")",r="value"===t.args[0].type?o:a(t.args[0],e)+"."+o}return!n||n.type===t.type&&"if"!==n.type||precedence.get(n.type).has(t.type)?r:"("+r+")"},stringifiers:{value:function(){return""},literal:function(t){return"string"==typeof t.value?"'"+t.value.replace("'","\\'")+"'":""+t.value},parameters:function(){return"$"},record:function(t,e,n){return"{"+Object.map(t.args,function(t,i){var r;return r="value"===t.type?"()":n(t,e),i+": "+r}).join(", ")+"}"},tuple:function(t,e,n){return"["+Object.map(t.args,function(t){return"value"===t.type?"()":n(t)}).join(", ")+"]"},component:function(t,e){var n;return e&&e.components&&t.component?e.components.getObjectLabel?n=e.components.getObjectLabel(t.component):e.components.getLabelForObject&&(n=e.components.getLabelForObject(t.component)):n=t.label,"@"+n},element:function(t){return"#"+t.id},mapBlock:makeBlockStringifier("map"),filterBlock:makeBlockStringifier("filter"),someBlock:makeBlockStringifier("some"),everyBlock:makeBlockStringifier("every"),sortedBlock:makeBlockStringifier("sorted"),groupBlock:makeBlockStringifier("group"),groupMapBlock:makeBlockStringifier("groupMap"),minBlock:makeBlockStringifier("min"),maxBlock:makeBlockStringifier("max"),property:function(t,e,n){return"value"===t.args[0].type?"string"==typeof t.args[1].value?t.args[1].value:"literal"===t.args[1].type?"."+t.args[1].value:"()["+n(t.args[1],e)+"]":"parameters"===t.args[0].type?"$"+t.args[1].value:"literal"===t.args[1].type&&/^[\w\d_]+$/.test(t.args[1].value)?n(t.args[0],e,{type:"scope"})+"."+t.args[1].value:n(t.args[0],{type:"scope"},e)+"["+n(t.args[1],e)+"]"},"with":function(t,e,n){var i=n(t.args[1],e,t);return n(t.args[0],e)+"."+i},get:function(t,e,n){var i;return i="value"===t.args[0].type?"()":n(t.args[0],e),i+"["+n(t.args[1],e)+"]"},not:function(t,e,n){return"equals"===t.args[0].type?n(t.args[0].args[0],e,{type:"equals"})+" != "+n(t.args[0].args[1],e,{type:"equals"}):"!"+n(t.args[0],e,t)},neg:function(t,e,n){return"-"+n(t.args[0],e,t)},toNumber:function(t,e,n){return"+"+n(t.args[0],e,t)},parent:function(t,e,n){return"^"+n(t.args[0],e,t)},"if":function(t,e,n){return n(t.args[0],e,t)+" ? "+n(t.args[1],e)+" : "+n(t.args[2],e)},event:function(t,e,n){return t.when+" "+t.event+" -> "+n(t.listener,e)},binding:function(t,e,n,i){var r=i(e.args[0],n)+" "+t+" "+i(e.args[1],n),a="",s=e.descriptor;if(s)for(var o in s)a+=", "+o+": "+i(s[o],n);return r+a},bind:function(t,e,n){return this.binding("<-",t,e,n)},bind2:function(t,e,n){return this.binding("<->",t,e,n)},assign:function(t,e,n){return n(t.args[0],e)+": "+n(t.args[1],e)},block:function(t,e,n){var i="@"+t.label;return t.connection&&("prototype"===t.connection?i+=" < ":"object"===t.connection&&(i+=" : "),i+=n({type:"literal",value:t.module}),t.exports&&"value"!==t.exports.type&&(i+=" "+n(t.exports,e))),i+" {\n"+t.statements.map(function(t){return"    "+n(t,e)+";\n"}).join("")+"}\n"},sheet:function(t,e,n){return"\n"+t.blocks.map(function(t){return n(t,e)}).join("\n")+"\n"}}},typeToToken.forEach(function(t,e){stringify.semantics.stringifiers[e]=function(e,n,i){return e.args.map(function(t){return i(t,n,e)}).join(" "+t+" ").trim()}});