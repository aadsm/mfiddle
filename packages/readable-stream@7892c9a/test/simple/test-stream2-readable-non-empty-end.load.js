montageDefine("7892c9a","test/simple/test-stream2-readable-non-empty-end",{dependencies:["assert","../common.js","../../lib/_stream_readable"],factory:function(e){function t(){throw Error("this should not happen!")}function n(){l.removeListener("end",t);var e=!1;process.on("exit",function(){i(e,"end should be emitted by now")}),l.on("end",function(){e=!0});var n=l.read();i(n),i.equal(n.length,1),n=l.read(),i.equal(n,null)}var i=e("assert");e("../common.js");for(var r=e("../../lib/_stream_readable"),a=0,s=Array(10),o=1;10>=o;o++)s[o-1]=new Buffer(o),a+=o;var l=new r,c=0;l._read=function(){var e=s[c++];setTimeout(function(){l.push(e)})},l.on("end",t);var u=0;l.on("readable",function(){var e=a-u-1,t=l.read(e);t&&(u+=t.length,console.error("br=%d len=%d",u,a),setTimeout(n)),l.read(0)}),l.read(0)}});