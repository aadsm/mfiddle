function makeLiteralObserver(e){return function(t){return t(e)||Function.noop}}function observeValue(e,t){return e(t.value)||Function.noop}function observeParameters(e,t){return e(t.parameters)||Function.noop}function makeElementObserver(e){return function(t,n){return t(n.document.getElementById(e))||Function.noop}}function makeComponentObserver(e,t){return function(n,i){var a=i.components,r=a.getObjectByLabel||a.getComponentByLabel,s=r.call(a,e);return t.component=s,n(s)||Function.noop}}function observeProperty(e,t,n,i){function a(e,t,i){r(),r=n(e,t,i)||Function.noop}if(null==e)return n();var r=Function.noop;return PropertyChanges.addOwnPropertyChangeListener(e,t,a,i.beforeChange),a(e[t],t,e),once(function(){r(),PropertyChanges.removeOwnPropertyChangeListener(e,t,a,i.beforeChange)})}function makePropertyObserver(e,t){return function(n,i){return t(autoCancelPrevious(function(t){return null==t?n():e(autoCancelPrevious(function(e){return null==e?n():e.observeProperty?e.observeProperty(t,n,i):_observeProperty(e,t,n,i)}),i)}),i)}}function observeGet(e,t,n,i){function a(e,i,a){s(t,i)&&(r(),r=n(e,t,a)||Function.noop)}var r=Function.noop,s=e.contentEquals||Object.equals;return a(e.get(t),t,e),e.addMapChangeListener(a,i.beforeChange),once(function(){r(),e.removeMapChangeListener(a)})}function makeGetObserver(e,t){return function(n,i){return e(autoCancelPrevious(function(e){return e?t(autoCancelPrevious(function(t){return null==t?n():e.observeGet?e.observeGet(t,n,i):_observeGet(e,t,n,i)}),i):n()}),i)}}function makeHasObserver(e,t){return function(n,i){return n=makeUniq(n),t(autoCancelPrevious(function(t){return e(autoCancelPrevious(function(e){return e?observeRangeChange(e,function(){return n((e.has||e.contains).call(e,t))},i):n()}),i)}),i)}}function makeObserversObserver(e){return function(t,n){for(var i=Array(e.length),a=0;e.length>a;a++)i[a]=void 0;var r=e.map(function(e,t){return e(function(e){i.set(t,e)},n)}),s=t(i)||Function.noop;return once(function(){s(),cancelEach(r)})}}function makeObjectObserver(e){return function(t,n){var i={},a={};for(var r in e)(function(e,t){i[e]=t(function(t){a[e]=t},n)})(r,e[r]);var s=t(a)||Function.noop;return function(){s();for(var e in i)i[e]()}}}function makeArrayObserver(){return makeObserversObserver(Array.prototype.slice.call(arguments))}function makeOperatorObserverMaker(e){return function(){var t=makeObserversObserver(Array.prototype.slice.call(arguments)),n=makeRangeContentObserver(t);return function(t,i){return n(autoCancelPrevious(function(n){return n.every(Operators.defined)?t(e.apply(void 0,n)):t()}),i)}}}function makeMethodObserverMaker(e){var t=e.slice(0,1).toUpperCase()+e.slice(1),n="make"+t+"Observer",i="observe"+t;return function(){var t=arguments[0],a=Array.prototype.slice.call(arguments,1),r=a.map(function(e){return function(t,n){return e(autoCancelPrevious(t),n)}}),s=makeObserversObserver(a),o=makeRangeContentObserver(s);return function(a,s){return t(autoCancelPrevious(function(t){return t?t[n]?t[n].apply(t,r)(a,s):t[i]?t[i](a,s):o(autoCancelPrevious(function(n){return n.every(Operators.defined)?"function"==typeof t[e]?a(t[e].apply(t,n)):a():a()}),s):a()}),s)}}}function makeNotObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return t(!e)}),n)}}function makeAndObserver(e,t){return function(n,i){return e(autoCancelPrevious(function(e){return e?t(n,i):n(e)}),i)}}function makeOrObserver(e,t){return function(n,i){return e(autoCancelPrevious(function(e){return e?n(e):t(n,i)}),i)}}function makeConditionalObserver(e,t,n){return function(i,a){return e(autoCancelPrevious(function(e){return null==e?i():e?t(i,a):n(i,a)}),a)}}function makeDefinedObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return t(null!=e)}),n)}}function makeDefaultObserver(e,t){return function(n,i){return e(autoCancelPrevious(function(e){return null==e?t(n,i):n(e)}),i)}}function makeReplacingMapBlockObserver(e,t){return function(n,i){return e(autoCancelPrevious(function(e){function a(t){for(;e.length>t;t++)o[t].index=t}function r(e,n,r){o.swap(r,n.length,e.map(function(e,t){return{index:r+t}})),a(r+e.length);var c,u=[];cancelEach(l.swap(r,n.length,e.map(function(e,n){var a=o[r+n];return t(autoCancelPrevious(function(e){c?s.set(a.index,e):u[n]=e}),Scope.nest(i,e))}))),c=!0,s.swap(r,n.length,u)}if(!e)return n();var s=[],o=[],l=[],c=observeRangeChange(e,r,i),u=n(s,e)||Function.noop;return once(function(){u(),cancelEach(l),c()})}),i)}}function makeReplacingFilterBlockObserver(e,t){var n=makeReplacingMapBlockObserver(e,t);return function(e,t){return n(autoCancelPrevious(function(n,i){function a(e){for(;n.length>e;e++)l[e+1]=l[e]+n[e]}function r(e,t,n){var r=i.slice(n,n+e.length),o=t.map(Boolean).sum(),c=r.filter(function(t,n){return e[n]}),u=l[n],h=s.slice(u,u+o);(h.length!==c.length||h.every(function(e,t){return e!==c[t]}))&&s.swap(u,o,c),a(u)}if(!i)return e();var s=[],o=[],l=[0],c=observeRangeChange(n,r,t),u=e(s)||Function.noop;return once(function(){u(),cancelEach(o),c()})}),t)}}function makeSortedBlockObserver(e,t){var n=makeRelationEntryObserver(t),i=makeReplacingMapBlockObserver(e,n),a=function(e,t){return i(autoCancelPrevious(function(n){function i(e,t){r.addEach(e),r.deleteEach(t)}if(!n)return e();var a=[],r=SortedArray(a,entryValueEquals,entryValueCompare),s=observeRangeChange(n,i,t),o=e(a)||Function.noop;return function(){o(),s()}}),t)};return makeMapBlockObserver(a,observeEntryKey)}function entryValueEquals(e,t){return Object.equals(e[1],t[1])}function entryValueCompare(e,t){return Object.compare(e[1],t[1])}function makeRelationEntryObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return t([n.value,e])||Function.noop}),n)}}function makeSortedSetBlockObserver(e,t){var n=makeRelationEntryObserver(t),i=makeReplacingMapBlockObserver(e,n),a=makeGroupBlockObserver(i,observeEntryValue),r=makeReplacingMapBlockObserver(a,makeLastObserver(observeEntryValue));return function(e,t){function n(e,t){return e=o.get(e),t=o.get(t),Object.compare(e,t)}function i(e,t){return e=o.get(e),t=o.get(t),Object.equals(e,t)}function a(e,t){t.forEach(function(e){l["delete"](e[0]),o["delete"](e[0])}),e.forEach(function(e){o.set(e[0],e[1]),l.add(e[0])})}function s(e){return l.clear(),observeRangeChange(e,a,t)}var o=new Map,l=new SortedSet(null,i,n),c=e(l)||Function.noop,u=r(s,t);return function(){c(),u()}}}function makeReplacingReversedObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){function i(e,t,n){var i=a.length-n-t.length;a.swap(i,t.length,e.reversed())}if(!e)return t();var a=[],r=observeRangeChange(e,i,n),s=t(a);return once(function(){s(),r()})}),n)}}function makeReplacingFlattenObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){function i(t){for(var n=t;e.length>n;n++)l[n].index=n,o[n+1]=e[n]?o[n]+e[n].length:o[n]}function a(e,t,a){var c=o[a],u=o[a+t.length],h=u-c;r.swap(c,h,[]),l.swap(a,t.length,e.map(function(){return{index:null}})),i(a),cancelEach(s.swap(a,t.length,e.map(function(e,t){function s(e,t,n){i(c.index);var a=o[c.index]+n,s=o[c.index]+n+t.length,l=s-a;r.swap(a,l,e)}var c=l[a+t];return observeRangeChange(e,s,n)})))}if(!e)return t();var r=[],s=[],o=[0],l=[],c=observeRangeChange(e,a,n),u=t(r)||Function.noop;return once(function(){u(),cancelEach(s),c()})}),n)}}function makeConcatObserver(){return makeFlattenObserver(makeObserversObserver(Array.prototype.slice.call(arguments)))}function makeSomeBlockObserver(e,t){var n=makeFilterBlockObserver(e,t),i=makePropertyObserver(n,observeLengthLiteral);return makeConverterObserver(i,Boolean)}function makeEveryBlockObserver(e,t){var n=makeConverterObserver(t,Operators.not),i=makeFilterBlockObserver(e,n),a=makePropertyObserver(i,observeLengthLiteral);return makeConverterObserver(a,Operators.not)}function makeGroupBlockObserver(e,t){var n=makeGroupMapBlockObserver(e,t);return makeEntriesObserver(n)}function makeGroupMapBlockObserver(e,t){var n=makeRelationEntryObserver(t),i=makeReplacingMapBlockObserver(e,n);return function(e,t){return i(autoCancelPrevious(function(n,i){function a(e,t){t.forEach(function(e){var t=r.get(e[1]);1===t.length?r["delete"](e[1]):t["delete"](e[0])}),e.forEach(function(e){var t,n=!r.has(e[1]);t=n?i.constructClone():r.get(e[1]),t.add(e[0]),n&&r.set(e[1],t)})}if(!n)return e();var r=Map(),s=observeRangeChange(n,a,t),o=e(r)||Function.noop;return function(){s(),o()}}),t)}}function makeHeapBlockObserver(e,t,n){function i(e,t){return Object.compare(e[1],t[1])*n}var a=makeRelationEntryObserver(t),r=makeReplacingMapBlockObserver(e,a);return function(e,t){return r(autoCancelPrevious(function(n){function a(e,t){s.addEach(e),s.deleteEach(t)}function r(t,n){return 0===n?t?e(t[0]):e():void 0}if(!n)return e();var s=new Heap(null,entryValueEquals,i),o=observeRangeChange(n,a,t),l=observeMapChange(s,r,t);return function(){o(),l()}}),t)}}function makeMaxBlockObserver(e,t){return makeHeapBlockObserver(e,t,1)}function makeMinBlockObserver(e,t){return makeHeapBlockObserver(e,t,-1)}function makeCollectionObserverMaker(e){return function(t){return function(n,i){return n=makeUniq(n),t(autoCancelPrevious(function(t){if(!t)return n();var a=e(t,n);return observeRangeChange(t,function(e,t,i){return n(a(e,t,i))},i)}),i)}}}function isNumber(e){return"number"==typeof e&&!isNaN(e)}function makeReplacingViewObserver(e,t,n){return function(i,a){return e(autoCancelPrevious(function(e){return e?n(autoCancelPrevious(function(n){return null==n?i():t(autoCancelPrevious(function(t){function r(i,a,r){var o=i.length-a.length;t>r&&0>o&&n>o?(s.swap(s.length,0,e.slice(t+n+o,t+n)),s.splice(0,-o)):t>r&&o>0&&n>o?(s.swap(0,0,e.slice(t,t+o)),s.splice(s.length-o,o)):r>=t&&0>o&&t+n>r?(s.swap(s.length,0,e.slice(t+n+o,t+n)),s.splice(r-t,-o)):r>=t&&o>0&&t+n>r?(s.swap(r-t,0,e.slice(r,r+o)),s.splice(s.length-o,o)):t+n>r&&s.swap(0,s.length,e.slice(t,t+n))}if(null==t)return i();var s=[],o=observeRangeChange(e,r,a),l=i(s)||Function.noop;return once(function(){l(),o()})}),a)}),a):i()}),a)}}function makeReplacingEnumerateObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){function i(e){for(;r.length>e;e++)r[e].set(0,e)}function a(e,t,n){r.swap(n,t.length,e.map(function(e,t){return[n+t,e]})),i(n+e.length)}if(!e)return t();var r=[],s=observeRangeChange(e,a,n),o=t(r)||Function.noop;return function(){o(),s()}}),n)}}function makeRangeObserver(e){return function(t,n){var i=[],a=t(i)||Function.noop,r=e(function(e){if(e>>>=0,null==e)i.clear();else if(e>i.length){for(var t=[],n=i.length;e>n;n++)t.push(n);i.swap(i.length,0,t)}else i.length>e&&i.splice(e,i.length)},n);return function(){a(),r()}}}function makeStartsWithObserver(e,t){return function(n,i){return t(function(t){var a=RegExp("^"+RegExp.escape(t));return e(function(e){return n(a.test(e))||Function.noop},i)},i)}}function makeEndsWithObserver(e,t){return function(n,i){return t(function(t){var a=RegExp(RegExp.escape(t)+"$");return e(function(e){return n(a.test(e))||Function.noop},i)},i)}}function makeContainsObserver(e,t){return function(n,i){return t(function(t){var a=RegExp(RegExp.escape(t));return e(function(e){return n(a.test(e))||Function.noop},i)},i)}}function makeJoinObserver(e,t){return t=t||observeNullStringLiteral,function(n,i){return e(autoCancelPrevious(function(e){return e?t(autoCancelPrevious(function(t){function a(){r=n(e.join(t))||Function.noop}if("string"!=typeof t)return n()||Function.noop;var r=Function.noop,s=observeRangeChange(e,a,i);return function(){s(),r()}}),i):n()||Function.noop}),i)}}function observeRangeChange(e,t,n){function i(e,n,i){a(),a=t(e,n,i)||Function.noop}if(e){var a=Function.noop;if(e.toArray&&e.addRangeChangeListener){i(e.toArray(),[],0);var r=e.addRangeChangeListener(i,n.beforeChange);return once(function(){a(),r()})}}}function makeLastObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return _observeLast(e,t,n)}),n)}}function observeLast(e,t,n){function i(n,i,o){if(a+=n.length-i.length,!(a>o+i.length&&a>o+n.length)){var l=0>a?null:e.get(a);r(),r=t(l)||Function.noop,s=l}}var a=-1,r=Function.noop,s=null,o=observeRangeChange(e,i,n);return function(){r(),o()}}function makeOnlyObserver(e){return function(t,n){return e(autoCancelPrevious(makeUniq(function(e){return observeOnly(e,t,n)})),n)}}function observeOnly(e,t,n){function i(n,i){return a+=n.length-i.length,1===a?t(e.only()):t()}var a=0;return observeRangeChange(e,i,n)}function makeRangeContentObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return e&&e.addRangeChangeListener?observeRangeChange(e,function(){return t(e)},n):t(e)}),n)}}function makeMapContentObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return e&&e.addMapChangeListener?observeMapChange(e,function(){return t(e)},n):t(e)}),n)}}function observeMapChange(e,t,n){function i(e,n,i){var r=a.get(n)||Function.noop;a["delete"](n),r(),r=t(e,n,i)||Function.noop,void 0===e?r():a.set(n,r)}if(e.addMapChangeListener){var a=new Map;e.forEach(i);var r=e.addMapChangeListener(i,n.beforeChange);return once(function(){a.forEach(function(e){e()}),r()})}}function makeReplacingEntriesObserver(e){return function(t,n){return e(autoCancelPrevious(function(e){return e?observeEntries(e,t,n):t()}),n)}}function observeEntries(e,t,n){function i(e,t){var n,i;r.has(t)?null==e?(n=r.get(t),r["delete"](t),i=a.indexOf(n),a.splice(i,1)):(n=r.get(t),n.set(1,e)):(n=[t,e],r.set(t,n),a.push(n))}var a=[],r=Map(),s=t(a)||Function.noop,o=observeMapChange(e,i,n)||Function.noop;return once(function(){s(),o()})}function makeKeysObserver(e){var t=makeEntriesObserver(e);return makeMapBlockObserver(t,observeEntryKey)}function observeEntryKey(e,t){return t.value?e(t.value[0])||Function.noop:e()}function makeValuesObserver(e){var t=makeEntriesObserver(e);return makeMapBlockObserver(t,observeEntryValue)}function observeEntryValue(e,t){return t.value?e(t.value[1])||Function.noop:e()}function makeToMapObserver(e){return function(t,n){var i=new Map,a=t(i)||Function.noop,r=e(autoCancelPrevious(function(e){function t(e,t){void 0===e?i["delete"](t):i.set(t,e)}if(i.clear(),e&&"object"==typeof e){if(e.addRangeChangeListener)return observeUniqueEntries(autoCancelPrevious(function(e){function t(e,t){t.forEach(function(e){i["delete"](e[0])}),e.forEach(function(e){i.set(e[0],e[1])})}return observeRangeChange(e,t,n)}),Scope.nest(n,e));if(e.addMapChangeListener)return observeMapChange(e,t,n);var a=Object.keys(e).map(function(t){return _observeProperty(e,t,autoCancelPrevious(function(e){void 0===e?i["delete"](t):i.set(t,e)}),n)});return function(){cancelEach(a)}}}),n);return function(){a(),r()}}}function makeParentObserver(e){return function(t,n){return e(t,n.parent||new Scope)}}function makeConverterObserver(e,t,n){return function(i,a){return i=makeUniq(i),e(autoCancelPrevious(function(e){return i(t.call(n,e))}),a)}}function makeComputerObserver(e,t,n){return function(i,a){return i=makeUniq(i),e(autoCancelPrevious(function(e){return e&&e.every(Operators.defined)?i(t.apply(n,e)):void 0}),a)}}function makeExpressionObserver(e,t){var n=require("./parse"),i=require("./compile-observer");return function(a,r){return a=makeUniq(a),t(autoCancelPrevious(function(t){if(null==t)return a();var s,o;try{s=n(t),o=i(s)}catch(l){return a()}return e(autoCancelPrevious(function(e){return o(a,Scope.nest(r,e))}),r)}),r)}}function makeWithObserver(e,t){return function(n,i){return e(autoCancelPrevious(function(e){return t(autoCancelPrevious(function(e){return n(e)}),Scope.nest(i,e))}),i)}}function makeNonReplacing(e){return function(){var t=e.apply(this,arguments);return function(e,n){var i=[],a=t(autoCancelPrevious(function(e){function t(e,t,n){i.swap(n,t.length,e)}if(e){merge(i,e);var a=e.addRangeChangeListener(t,n.beforeChange);return once(a)}i.clear()}),n),r=e(i)||Function.noop;return once(function(){a(),r()})}}}function makeUniq(e){var t;return function(n){if(n!==t){var i=e.apply(this,arguments);return t=n,i}}}function cancelEach(e){e.forEach(function(e){e&&e()})}function autoCancelPrevious(e){var t=Function.noop;return function(){return t(),t=e.apply(this,arguments)||Function.noop,function(){t()}}}function once(e){var t;return function(){return t?Function.noop:(t=!0,e.apply(this,arguments))}}require("collections/shim");var PropertyChanges=require("collections/listen/property-changes");require("collections/listen/array-changes");var SortedArray=require("collections/sorted-array"),SortedSet=require("collections/sorted-set"),Map=require("collections/map"),Set=require("collections/set"),Heap=require("collections/heap"),Scope=require("./scope"),Operators=require("./operators");exports.makeLiteralObserver=makeLiteralObserver,exports.observeValue=observeValue,exports.observeParameters=observeParameters,exports.makeElementObserver=makeElementObserver,exports.makeComponentObserver=makeComponentObserver,exports.observeProperty=observeProperty;var _observeProperty=observeProperty;exports.makePropertyObserver=makePropertyObserver,exports.observeKey=observeGet,exports.observeGet=observeGet;var _observeGet=observeGet;exports.makeGetObserver=makeGetObserver,exports.makeHasObserver=makeHasObserver,exports.makeObserversObserver=makeObserversObserver,exports.makeRecordObserver=makeObjectObserver,exports.makeObjectObserver=makeObjectObserver,exports.makeTupleObserver=makeArrayObserver,exports.makeArrayObserver=makeArrayObserver,exports.makeOperatorObserverMaker=makeOperatorObserverMaker,exports.makeMethodObserverMaker=makeMethodObserverMaker,exports.makeNotObserver=makeNotObserver,exports.makeAndObserver=makeAndObserver,exports.makeOrObserver=makeOrObserver,exports.makeConditionalObserver=makeConditionalObserver,exports.makeDefinedObserver=makeDefinedObserver,exports.makeDefaultObserver=makeDefaultObserver;var makeMapBlockObserver=exports.makeMapBlockObserver=makeNonReplacing(makeReplacingMapBlockObserver),makeFilterBlockObserver=exports.makeFilterBlockObserver=makeNonReplacing(makeReplacingFilterBlockObserver);exports.makeSortedBlockObserver=makeSortedBlockObserver,exports.makeSortedSetBlockObserver=makeSortedSetBlockObserver,exports.makeReversedObserver=makeNonReplacing(makeReplacingReversedObserver);var makeFlattenObserver=exports.makeFlattenObserver=makeNonReplacing(makeReplacingFlattenObserver);exports.makeConcatObserver=makeConcatObserver,exports.makeSomeBlockObserver=makeSomeBlockObserver,exports.makeEveryBlockObserver=makeEveryBlockObserver,exports.makeGroupBlockObserver=makeGroupBlockObserver,exports.makeGroupMapBlockObserver=makeGroupMapBlockObserver,exports.makeMaxBlockObserver=makeMaxBlockObserver,exports.makeMinBlockObserver=makeMinBlockObserver;var observeLengthLiteral=makeLiteralObserver("length");exports.makeSumObserver=makeCollectionObserverMaker(function(){var e=0;return function(t,n){return t=t.filter(isNumber),n=n.filter(isNumber),e+=t.sum()-n.sum()}}),exports.makeAverageObserver=makeCollectionObserverMaker(function(){var e=0,t=0;return function(n,i){return n=n.filter(isNumber),i=i.filter(isNumber),e+=n.sum()-i.sum(),t+=n.length-i.length,e/t}}),exports.makeViewObserver=makeNonReplacing(makeReplacingViewObserver),exports.makeEnumerateObserver=makeNonReplacing(makeReplacingEnumerateObserver),exports.makeEnumerationObserver=exports.makeEnumerateObserver,exports.makeRangeObserver=makeRangeObserver,exports.makeStartsWithObserver=makeStartsWithObserver,exports.makeEndsWithObserver=makeEndsWithObserver,exports.makeContainsObserver=makeContainsObserver,exports.makeJoinObserver=makeJoinObserver;var observeNullStringLiteral=makeLiteralObserver("");exports.observeRangeChange=observeRangeChange,exports.makeLastObserver=makeLastObserver,exports.observeLast=observeLast;var _observeLast=observeLast;exports.makeOnlyObserver=makeOnlyObserver,exports.observeOnly=observeOnly,exports.makeRangeContentObserver=makeRangeContentObserver,exports.makeMapContentObserver=makeMapContentObserver,exports.observeMapChange=observeMapChange;var makeEntriesObserver=exports.makeEntriesObserver=makeNonReplacing(makeReplacingEntriesObserver);exports.observeEntries=observeEntries,exports.makeKeysObserver=makeKeysObserver,exports.observeEntryKey=observeEntryKey,exports.makeValuesObserver=makeValuesObserver,exports.observeEntryValue=observeEntryValue,exports.makeToMapObserver=makeToMapObserver;var observeUniqueEntries=makeMapBlockObserver(makeGroupBlockObserver(observeValue,observeEntryKey),makeLastObserver(observeEntryValue));exports.makeParentObserver=makeParentObserver,exports.makeConverterObserver=makeConverterObserver,exports.makeComputerObserver=makeComputerObserver,exports.makePathObserver=makeExpressionObserver,exports.makeExpressionObserver=makeExpressionObserver,exports.makeWithObserver=makeWithObserver,exports.makeToArrayObserver=makeNonReplacing(Function.identity),exports.makeAsArrayObserver=exports.makeToArrayObserver;var merge=require("./merge").merge;exports.makeUniq=makeUniq,exports.cancelEach=cancelEach,exports.autoCancelPrevious=autoCancelPrevious,exports.once=once;