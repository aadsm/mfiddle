function compile(t){return compile.semantics.compile(t)}var compileEvaluator=require("./compile-evaluator"),solve=require("./algebra"),Scope=require("./scope"),valueSyntax={type:"value"},trueScope={type:"literal",value:!0},falseScope={type:"literal",value:!1};module.exports=compile,compile.semantics={compile:function(t){var e=this.compilers;if("equals"===t.type){var n=this.compile(t.args[0]),i=this.compileEvaluator(t.args[1]);return e.equals(n,i)}if("if"===t.type){var a=this.compileEvaluator(t.args[0]),r=this.compile(t.args[1]),s=this.compile(t.args[2]);return e["if"](a,r,s)}if("and"===t.type||"or"===t.type){var o=solve(t.args[0],valueSyntax),l=solve(t.args[1],valueSyntax),c=this.compileEvaluator(t.args[0]),i=this.compileEvaluator(t.args[1]),h=this.compileEvaluator(o[1]),u=this.compileEvaluator(l[1]),n=this.compile(o[0]),d=this.compile(l[0]);return e[t.type](n,d,c,i,h,u)}if("everyBlock"===t.type){var p=this.compileEvaluator(t.args[0]),g=solve(t.args[1],{type:"literal",value:!0}),m=this.compile(g[0]),f=this.compileEvaluator(g[1]);return e.everyBlock(p,m,f)}if(e.hasOwnProperty(t.type)){var v=t.args.map(this.compileEvaluator,this.compileEvaluator.semantics);return e[t.type].apply(null,v)}throw Error("Can't compile assigner for "+JSON.stringify(t.type))},compileEvaluator:compileEvaluator,compilers:{property:function(t,e){return function(n,i){var a=t(i);if(a){var r=e(i);null!=r&&(Array.isArray(a)?a.set(r,n):a[r]=n)}}},get:function(t,e){return function(n,i){var a=t(i);if(a){var r=e(i);null!=r&&a.set(r,n)}}},has:function(t,e){return function(n,i){var a=t(i);if(a){var r=e(i);null!=n&&(n?(a.has||a.contains).call(a,r)||a.add(r):(a.has||a.contains).call(a,r)&&(a.remove||a["delete"]).call(a,r))}}},equals:function(t,e){return function(n,i){return n?t(e(i),i):void 0}},"if":function(t,e,n){return function(i,a){var r=t(a);if(null!=r)return r?e(i,a):n(i,a)}},and:function(t,e,n,i,a,r){return function(s,o){null!=s&&(s?(t(a(trueScope),o),e(r(trueScope),o)):t(n(o)&&!i(o),o))}},or:function(t,e,n,i,a,r){return function(s,o){null!=s&&(s?t(n(o)||!i(o),o):(t(a(falseScope),o),e(r(falseScope),o)))}},rangeContent:function(t){return function(e,n){var i=t(n);i&&(e?i.swap(0,i.length,e):i.clear())}},mapContent:function(t){return function(e,n){var i=t(n);i&&(i.clear(),n.value&&i.addEach(e))}},reversed:function(t){return function(e,n){var i=t(n);i&&i.swap(0,i.length,e.reversed())}},everyBlock:function(t,e,n){return function(i,a){if(i){var r=t(a),s=n(a);r.forEach(function(t){e(s,Scope.nest(a,t))})}}}}};