function PropertyChanges(){throw Error("This is an abstract interface. Mix it. Don't construct it")}require("../shim");var WeakMap=require("../weak-map"),object_owns=Object.prototype.hasOwnProperty,propertyChangeDescriptors=new WeakMap,overriddenObjectDescriptors=new WeakMap;module.exports=PropertyChanges,PropertyChanges.debug=!0,PropertyChanges.prototype.getOwnPropertyChangeDescriptor=function(t){propertyChangeDescriptors.has(this)||propertyChangeDescriptors.set(this,{});var e=propertyChangeDescriptors.get(this);return object_owns.call(e,t)||(e[t]={willChangeListeners:[],changeListeners:[]}),e[t]},PropertyChanges.prototype.hasOwnPropertyChangeDescriptor=function(t){if(!propertyChangeDescriptors.has(this))return!1;if(!t)return!0;var e=propertyChangeDescriptors.get(this);return object_owns.call(e,t)?!0:!1},PropertyChanges.prototype.addOwnPropertyChangeListener=function(t,e,n){this.makeObservable&&!this.isObservable&&this.makeObservable();var i,a=PropertyChanges.getOwnPropertyChangeDescriptor(this,t);i=n?a.willChangeListeners:a.changeListeners,PropertyChanges.makePropertyObservable(this,t),i.push(e);var r=this;return function(){PropertyChanges.removeOwnPropertyChangeListener(r,t,i,n),r=null}},PropertyChanges.prototype.addBeforeOwnPropertyChangeListener=function(t,e){return PropertyChanges.addOwnPropertyChangeListener(this,t,e,!0)},PropertyChanges.prototype.removeOwnPropertyChangeListener=function(t,e,n){var i,a=PropertyChanges.getOwnPropertyChangeDescriptor(this,t);i=n?a.willChangeListeners:a.changeListeners;var r=i.lastIndexOf(e);if(-1===r)throw Error("Can't remove listener: does not exist.");i.splice(r,1),0===a.changeListeners.length+a.willChangeListeners.length&&PropertyChanges.makePropertyUnobservable(this,t)},PropertyChanges.prototype.removeBeforeOwnPropertyChangeListener=function(t,e){return PropertyChanges.removeOwnPropertyChangeListener(this,t,e,!0)},PropertyChanges.prototype.dispatchOwnPropertyChange=function(t,e,n){var i=PropertyChanges.getOwnPropertyChangeDescriptor(this,t);if(!i.isActive){i.isActive=!0;var a;a=n?i.willChangeListeners:i.changeListeners;var r=(n?"Will":"")+"Change",s="handleProperty"+r,o=t+"";o=o&&o[0].toUpperCase()+o.slice(1);var l="handle"+o+r;try{a.forEach(function(n){var i=n;n=n[l]||n[s]||n,n.call(i,e,t,this)},this)}finally{i.isActive=!1}}},PropertyChanges.prototype.dispatchBeforeOwnPropertyChange=function(t,e){return PropertyChanges.dispatchOwnPropertyChange(this,t,e,!0)},PropertyChanges.prototype.makePropertyObservable=function(t){if(!Array.isArray(this)){if(!Object.isExtensible(this,t))throw Error("Can't make property "+JSON.stringify(t)+" observable on "+this+" because object is not extensible");var e;"object"==typeof this.__state__?e=this.__state__:(e={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:e,writable:!0,enumerable:!1})),e[t]=this[t],overriddenObjectDescriptors.has(this)||(n={},overriddenObjectDescriptors.set(this,n));var n=overriddenObjectDescriptors.get(this);if(!object_owns.call(n,t)){var i,a=this;Object.getOwnPropertyDescriptor(a,t);do{if(i=Object.getOwnPropertyDescriptor(a,t))break;a=Object.getPrototypeOf(a)}while(a);if(i=i||{value:void 0,enumerable:!0,writable:!0,configurable:!0},!i.configurable)throw Error("Can't observe non-configurable properties");if(n[t]=i,i.writable||i.set){var r;r="value"in i?{get:function(){return i.value},set:function(n){return n===i.value?n:(PropertyChanges.dispatchBeforeOwnPropertyChange(this,t,i.value),i.value=n,e[t]=n,PropertyChanges.dispatchOwnPropertyChange(this,t,n),n)},enumerable:i.enumerable,configurable:!0}:{get:function(){return i.get?i.get.apply(this,arguments):void 0},set:function(n){var a;return i.get&&(a=i.get.apply(this,arguments)),i.set&&i.set.apply(this,arguments),i.get&&(n=i.get.apply(this,arguments),e[t]=n),n===a?n:(PropertyChanges.dispatchBeforeOwnPropertyChange(this,t,a),PropertyChanges.dispatchOwnPropertyChange(this,t,n),n)},enumerable:i.enumerable,configurable:!0},Object.defineProperty(this,t,r)}}}},PropertyChanges.prototype.makePropertyUnobservable=function(t){if(!Array.isArray(this)){if(!overriddenObjectDescriptors.has(this))throw Error("Can't uninstall observer on property");var e=overriddenObjectDescriptors.get(this);if(!e[t])throw Error("Can't uninstall observer on property");var n=e[t];delete e[t];var i;"object"==typeof this.__state__?i=this.__state__:(i={},Object.isExtensible(this,"__state__")&&Object.defineProperty(this,"__state__",{value:i,writable:!0,enumerable:!1})),delete i[t],Object.defineProperty(this,t,n)}},PropertyChanges.getOwnPropertyChangeDescriptor=function(t,e){return t.getOwnPropertyChangeDescriptor?t.getOwnPropertyChangeDescriptor(e):PropertyChanges.prototype.getOwnPropertyChangeDescriptor.call(t,e)},PropertyChanges.hasOwnPropertyChangeDescriptor=function(t,e){return t.hasOwnPropertyChangeDescriptor?t.hasOwnPropertyChangeDescriptor(e):PropertyChanges.prototype.hasOwnPropertyChangeDescriptor.call(t,e)},PropertyChanges.addOwnPropertyChangeListener=function(t,e,n,i){return Object.isObject(t)?t.addOwnPropertyChangeListener?t.addOwnPropertyChangeListener(e,n,i):PropertyChanges.prototype.addOwnPropertyChangeListener.call(t,e,n,i):void 0},PropertyChanges.removeOwnPropertyChangeListener=function(t,e,n,i){return Object.isObject(t)?t.removeOwnPropertyChangeListener?t.removeOwnPropertyChangeListener(e,n,i):PropertyChanges.prototype.removeOwnPropertyChangeListener.call(t,e,n,i):void 0},PropertyChanges.dispatchOwnPropertyChange=function(t,e,n,i){return Object.isObject(t)?t.dispatchOwnPropertyChange?t.dispatchOwnPropertyChange(e,n,i):PropertyChanges.prototype.dispatchOwnPropertyChange.call(t,e,n,i):void 0},PropertyChanges.addBeforeOwnPropertyChangeListener=function(t,e,n){return PropertyChanges.addOwnPropertyChangeListener(t,e,n,!0)},PropertyChanges.removeBeforeOwnPropertyChangeListener=function(t,e,n){return PropertyChanges.removeOwnPropertyChangeListener(t,e,n,!0)},PropertyChanges.dispatchBeforeOwnPropertyChange=function(t,e,n){return PropertyChanges.dispatchOwnPropertyChange(t,e,n,!0)},PropertyChanges.makePropertyObservable=function(t,e){return t.makePropertyObservable?t.makePropertyObservable(e):PropertyChanges.prototype.makePropertyObservable.call(t,e)},PropertyChanges.makePropertyUnobservable=function(t,e){return t.makePropertyUnobservable?t.makePropertyUnobservable(e):PropertyChanges.prototype.makePropertyUnobservable.call(t,e)};