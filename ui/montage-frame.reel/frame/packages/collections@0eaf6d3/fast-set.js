"use strict";function FastSet(t,e,n,i){return this instanceof FastSet?(e=e||Object.equals,n=n||Object.hash,i=i||Function.noop,this.contentEquals=e,this.contentHash=n,this.getDefault=i,this.buckets=new this.Buckets(null,this.Bucket),this.length=0,this.addEach(t),void 0):new FastSet(t,e,n,i)}var Shim=require("./shim"),Dict=require("./dict"),List=require("./list"),GenericCollection=require("./generic-collection"),GenericSet=require("./generic-set"),TreeLog=require("./tree-log"),PropertyChanges=require("./listen/property-changes"),object_has=Object.prototype.hasOwnProperty;module.exports=FastSet,Object.addEach(FastSet.prototype,GenericCollection.prototype),Object.addEach(FastSet.prototype,GenericSet.prototype),Object.addEach(FastSet.prototype,PropertyChanges.prototype),FastSet.prototype.Buckets=Dict,FastSet.prototype.Bucket=List,FastSet.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},FastSet.prototype.has=function(t){var e=this.contentHash(t);return this.buckets.get(e).has(t)},FastSet.prototype.get=function(t){var e=this.contentHash(t),n=this.buckets;return n.has(e)?n.get(e).get(t):this.getDefault(t)},FastSet.prototype["delete"]=function(t){var e=this.contentHash(t),n=this.buckets;if(n.has(e)){var i=n.get(e);if(i["delete"](t))return this.length--,0===i.length&&n["delete"](e),!0}return!1},FastSet.prototype.clear=function(){this.buckets.clear(),this.length=0},FastSet.prototype.add=function(t){var e=this.contentHash(t),n=this.buckets;return n.has(e)||n.set(e,new this.Bucket(null,this.contentEquals)),n.get(e).has(t)?!1:(n.get(e).add(t),this.length++,!0)},FastSet.prototype.reduce=function(t,e){var n=arguments[2],i=this.buckets,a=0;return i.reduce(function(e,i){return i.reduce(function(e,i){return t.call(n,e,i,a++,this)},e,this)},e,this)},FastSet.prototype.one=function(){return this.length>0?this.buckets.one().one():void 0},FastSet.prototype.iterate=function(){return this.buckets.values().flatten().iterate()},FastSet.prototype.log=function(t,e,n,i){t=t||TreeLog.unicodeSharp,e=e||this.logNode,n||(n=console.log,i=console),n=n.bind(i);var a=this.buckets,r=a.keys();r.forEach(function(s,o){var l,c;o===r.length-1?(l=t.fromAbove,c=" "):0===o?(l=t.branchDown,c=t.strafe):(l=t.fromBoth,c=t.strafe);var h=a.get(s);n.call(i,l+t.through+t.branchDown+" "+s),h.forEach(function(a,r){var s,o;r===h.head.prev?(s=t.fromAbove,o=" "):(s=t.fromBoth,o=t.strafe);var l;e(r,function(e){l?n.call(i,c+" "+o+"  "+e):(n.call(i,c+" "+s+t.through+t.through+e),l=!0)},function(e){n.call(i,c+" "+t.strafe+"  "+e)})})})},FastSet.prototype.logNode=function(t,e){var n=t.value;Object(n)===n?JSON.stringify(n,null,4).split("\n").forEach(function(t){e(" "+t)}):e(" "+n)};