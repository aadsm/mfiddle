montageDefine("280061e","serialization/builder",{dependencies:["./ast"],factory:function(t,e){(function(e){function n(){this.init()}var a=t("./ast");Object.defineProperties(n.prototype,{_root:{value:null,writable:!0},_stack:{value:null,writable:!0},_references:{value:null,writable:!0},_placeholderProperty:{value:Object.create(null)},init:{value:function(){return this._references=Object.create(null),this._root=new a.Root,this._stack=[this._root],this}},cleanup:{value:function(){this._references=null,this._root=null,this._stack=null}},getExternalReferences:{value:function(){var t=this._references,e=this._root,n=[];for(var a in t)e.hasProperty(a)&&e.getProperty(a)!==this._placeholderProperty||n.push(a);return n}},relabelReferences:{value:function(t,e){var n=this._references[t];if(n){n=n.slice(0);for(var a=0,i=n.length;i>a;a++)n[a].value=e}}},_registerReference:{value:function(t){var e=this._references,n=t.value;e[n]?e[n].push(t):e[n]=[t]}},_unregisterReference:{value:function(t){var e,n=t.label,a=this._references[n];1===a.length?delete this._references[n]:(e=a.indexOf(t),-1===e?console.log("BUG: reference '"+n+"' not found in registry."):a.splice(e,1))}},_createPlaceholdersForReferences:{value:function(){var t=this._references,e=this._root;for(var n in t)e.hasProperty(n)||e.setProperty(n,this._placeholderProperty)}},getSerialization:{value:function(t){return this._createPlaceholdersForReferences(),this._root.serialize(t)}},root:{get:function(){return this._root}},top:{get:function(){return this._stack[0]}},push:{value:function(t){return this._stack.unshift(t)}},pop:{value:function(){return this._stack.shift()}},createObjectLiteral:{value:function(){return new a.ObjectLiteral(this._root,Object.create(null))}},createArray:{value:function(){return new a.ObjectLiteral(this._root,[])}},createObjectReference:{value:function(t){var e=new a.ObjectReference(this._root,t);return this._registerReference(e),e}},createRegExp:{value:function(t){return new a.RegExpObject(this._root,t)}},createString:{value:function(t){return new a.Value(this._root,t)}},createNumber:{value:function(t){return new a.Value(this._root,t)}},createBoolean:{value:function(t){return new a.Value(this._root,t)}},createNull:{value:function(){return new a.Value(this._root,null)}},createCustomObject:{value:function(){return new a.CustomObject(this._root)}}}),e.Builder=n})(e)}});