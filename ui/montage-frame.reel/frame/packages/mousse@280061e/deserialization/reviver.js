(function(t){function e(){}function n(t){var n=e.prototype.getCustomObjectTypeOf;return function(e){return t(e)||n(e)}}var a=function(){return this}(),i=require("q");Object.defineProperties(e.prototype,{_createAssignValueFunction:{value:function(t,e){return function(n){t[e]=n}}},getTypeOf:{value:function(t){var e=typeof t;return null===t?"null":Array.isArray(t)?"array":"object"===e&&1===Object.keys(t).length?"@"in t?"reference":"/"in t?"regexp":"object":e}},getCustomObjectTypeOf:{writable:!0,value:function(){}},reviveRootObject:{value:function(t,e,n){var a;return t.debugger,"value"in t?e.hasUserObject(n)?(a=e.getUserObject(n),e.setObjectLabel(a,n),a):this.reviveValue(t.value,e,n):0===Object.keys(t).length?e.hasUserObject(n)?(a=e.getUserObject(n),e.setObjectLabel(a,n),a):this.reviveExternalObject(t,e,n):this.reviveCustomObject(t,e,n)}},reviveValue:{value:function(t,e,n){var a=this.getTypeOf(t);return"string"===a||"number"===a||"boolean"===a||"null"===a||"undefined"===a?this.reviveNativeValue(t,e,n):"regexp"===a?this.reviveRegExp(t,e,n):"reference"===a?this.reviveObjectReference(t,e,n):"array"===a?this.reviveArray(t,e,n):"object"===a?this.reviveObjectLiteral(t,e,n):this._callReviveMethod("revive"+a,t,e,n)}},reviveNativeValue:{value:function(t,e,n){return n&&e.setObjectLabel(t,n),t}},reviveObjectLiteral:{value:function(t,e,n){var a,r=[];n&&e.setObjectLabel(t,n);for(var s in t)a=this.reviveValue(t[s],e),i.isPromise(a)?r.push(a.then(this._createAssignValueFunction(t,s))):t[s]=a;return 0===r.length?t:i.all(r).then(function(){return t})}},reviveRegExp:{value:function(t,e,n){var t=t["/"],a=RegExp(t.source,t.flags);return n&&e.setObjectLabel(a,n),a}},reviveObjectReference:{value:function(t,e){var t=t["@"],n=e.getObject(t);return n}},reviveArray:{value:function(t,e,n){var a,r=[];n&&e.setObjectLabel(t,n);for(var s=0,o=t.length;o>s;s++)a=this.reviveValue(t[s],e),i.isPromise(a)?r.push(a.then(this._createAssignValueFunction(t,s))):t[s]=a;return 0===r.length?t:i.all(r).then(function(){return t})}},reviveCustomObject:{value:function(t,e,n){var s=this.getCustomObjectTypeOf(t),o=r["revive"+s];return s?o.call(a,t,e,n):i.reject(Error("Object's type is unknown: "+JSON.stringify(t)))}},reviveExternalObject:{value:function(t,e,n){return i.reject(Error("External object '"+n+"' not found in user objects."))}},_callReviveMethod:{value:function(t,e,n,a){return this[t](e,n,a)}}});var r=Object.create(null);e.addCustomObjectReviver=function(t){for(var e in t)if("getTypeOf"!==e&&"function"==typeof t[e]&&/^revive/.test(e)){if(void 0!==r[e])return Error("Reviver '"+e+"' is already registered.");r[e]=t[e].bind(t)}this.prototype.getCustomObjectTypeOf=n(t.getTypeOf)},e.resetCustomObjectRevivers=function(){r=Object.create(null),this.prototype.getCustomObjectTypeOf=function(){}},t.Reviver=e})(exports),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});