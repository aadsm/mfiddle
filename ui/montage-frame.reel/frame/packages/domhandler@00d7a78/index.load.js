montageDefine("00d7a78","index",{dependencies:["domelementtype"],factory:function(e,t,n){function a(e,t,n){"object"==typeof e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t=r),this._callback=e,this._options=t||r,this._elementCB=n,this.dom=[],this._done=!1,this._tagStack=[]}var i=e("domelementtype"),r={ignoreWhitespace:!1};a.prototype.onreset=function(){a.call(this,this._callback,this._options,this._elementCB)},a.prototype.onend=function(){this._done||(this._done=!0,this._handleCallback(null))},a.prototype._handleCallback=a.prototype.onerror=function(e){if("function"==typeof this._callback)this._callback(e,this.dom);else if(e)throw e},a.prototype.onclosetag=function(){var e=this._tagStack.pop();this._elementCB&&this._elementCB(e)},a.prototype._addDomElement=function(e){var t=this._tagStack[this._tagStack.length-1];t?t.children.push(e):this.dom.push(e)},a.prototype.onopentag=function(e,t){var n=this._tagStack[this._tagStack.length-1],a={type:"script"===e?i.Script:"style"===e?i.Style:i.Tag,name:e,attribs:t,children:[],prev:null,next:null,parent:n||null};if(n){for(var r=n.children.length;r>0;)if(i.isTag(n.children[--r])){a.prev=n.children[r],n.children[r].next=a;break}n.children.push(a)}else this.dom.push(a);this._tagStack.push(a)},a.prototype.ontext=function(e){if(!this._options.ignoreWhitespace||""!==e.trim()){if(this._tagStack.length){var t;if((t=this._tagStack[this._tagStack.length-1])&&(t=t.children[t.children.length-1])&&t.type===i.Text)return t.data+=e,void 0}else if(this.dom.length&&this.dom[this.dom.length-1].type===i.Text)return this.dom[this.dom.length-1].data+=e,void 0;this._addDomElement({data:e,type:i.Text})}},a.prototype.oncomment=function(e){var t=this._tagStack[this._tagStack.length-1];if(t&&t.type===i.Comment)return t.data+=e,void 0;var n={data:e,type:i.Comment};this._addDomElement(n),this._tagStack.push(n)},a.prototype.oncdatastart=function(){var e={children:[{data:"",type:i.Text}],type:i.CDATA};this._addDomElement(e),this._tagStack.push(e)},a.prototype.oncommentend=a.prototype.oncdataend=function(){this._tagStack.pop()},a.prototype.onprocessinginstruction=function(e,t){this._addDomElement({name:e,data:t,type:i.Directive})},n.exports=a}});