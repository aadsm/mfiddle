var Template=require("montage/core/template").Template,Component=require("montage/ui/component").Component,Promise=require("montage/core/promise").Promise,rootComponent=require("montage/ui/component").__root__;window.Frame={_MODULE_ID:"mfiddle",_javascript:document.querySelector('script[type="text/montage-javascript"]'),reset:function(){for(var e,t=rootComponent.childComponents,n=0;e=t[n];n++)e.detachFromParentComponent(),e.cleanupDeletedComponentTree();rootComponent.needsDraw=!1},boot:function(){var e=this,t=this._javascript.textContent.replace(/^\s*|\s*$/g,"");t?this._defineModule(t,function(t){var n=t.Owner;n?e.instantiate(new t.Owner):e.instantiate()}):this.instantiate()},instantiate:function(e){e&&(e.hasTemplate=!1),require("montage/core/template").instantiateDocument(window.document,window.require,{owner:e}).then(function(){e&&e.attachToParentComponent(),rootComponent.needsDraw=!0}).done()},_defineModule:function(e,t){var n=this,a=this._parseDependencies(e),o=Function("require","exports","module",e);Promise.all(a.map(require.deepLoad)).then(function(){var e={};o(require,e,require.getModule(n._MODULE_ID)),n._addMontageMetadata(e),require.inject(n._MODULE_ID,e),t(require(n._MODULE_ID))})},_addMontageMetadata:function(e){for(var t in e){var n=e[t];n instanceof Object&&(n.hasOwnProperty("_montage_metadata")&&!n._montage_metadata.isInstance?(n._montage_metadata.aliases.push(t),n._montage_metadata.objectName=t):Object.isSealed(n)||Object.defineProperty(e[t],"_montage_metadata",{value:{require:require,module:this._MODULE_ID,moduleId:this._MODULE_ID,property:t,objectName:t,aliases:[t],isInstance:!1}}))}},_parseDependencies:function(e){var t={};return e.replace(/(?:^|[^\w\$_.])require\s*\(\s*["']([^"']*)["']\s*\)/g,function(e,n){t[n]=!0}),Object.keys(t)}},/(iPad|iPhone|iPod).+OS 6/.test(window.navigator.userAgent)&&(rootComponent.requestAnimationFrame=null),window.parent.postMessage("ready","*");